let stats_keys,latest_keys,settings={global:{internal_clock:1e3,stats_clock:6e4},stats:{refresh_rate:5}},state={stats:{followers:{enabled:!1,count:0,icon:"heart"},subs:{enabled:!1,count:0,icon:"crown"},viewers:{enabled:!1,count:0,icon:"eye"}},latest:{follower:{enabled:!1,name:"",icon:"heart",empty:""},subscriber:{enabled:!1,name:"",amount:0,icon:"crown",empty:""},donation:{enabled:!1,name:"",amount:0,icon:"money-bill-wave",empty:""},cheer:{enabled:!1,name:"",amount:0,icon:"gem",empty:""},raid:{enabled:!1,name:"",amount:0,icon:"handshake",empty:""}}},channelName="",stats_pos=0,stats_width=0,latest_pos=0,currency="";const stats_container=document.querySelector(".stats-container"),latest_container=document.querySelector(".latest-container"),clock=document.querySelector(".clock");function start(){stats_keys=Object.keys(state.stats),latest_keys=Object.keys(state.latest),state.stats.viewers&&(getViewerStat(),setInterval((function(){getViewerStat()}),settings.global.stats_clock)),updateFields(),setInterval(updateFields,1e3*settings.stats.refresh_rate)}function getViewerStat(){fetch(`https://decapi.me/twitch/viewercount/${channelName}`).then((t=>t.text())).then((t=>{t.includes("offline")?state.stats.viewers.count=0:state.stats.viewers.count=t}))}function updateFields(){stats_container.innerHTML=`<span class="text">${state.stats[stats_keys[stats_pos]].count}<i class="fa-solid fa-${state.stats[stats_keys[stats_pos]].icon}"></i></span>`,stats_pos++,stats_pos==stats_keys.length&&(stats_pos=0);let t=state.latest[latest_keys[latest_pos]],e=latest_keys[latest_pos];if(""!=t.name){let s="";switch(s+="<span class='text'>",e){case"follower":s+=`<i class='fa-solid fa-${t.icon}'></i> ${t.name}`;break;case"subscriber":s+=`<i class='fa-solid fa-${t.icon}'></i> ${t.name} <span class='accent'>${t.amount} ${t.amount>1?"Months":"Month"}</span>`;break;case"donation":s+=`<i class='fa-solid fa-${t.icon}'></i> ${t.name} <span class='accent'>${currency}${t.amount.toFixed(2)}</span>`;break;case"cheer":s+=`<i class='fa-solid fa-${t.icon}'></i> ${t.name} <span class='accent'>${t.amount} ${t.amount>1?"Bits":"Bit"}</span>`;break;case"raid":s+=`<i class='fa-solid fa-${t.icon}'></i> ${t.name} <span class='accent'>${t.amount} ${t.amount>1?"Viewers":"Viewer"}</span>`}s+="</span>",latest_container.innerHTML=s}latest_pos++,latest_pos==latest_keys.length&&(latest_pos=0);const s=new Date;let a=s.getHours(),n=s.getMinutes();a=checkTime(a),n=checkTime(n),clock.textContent=`${a}:${n}`}function checkTime(t){return t<10&&(t="0"+t),t}window.addEventListener("onWidgetLoad",(function(t){let e=t.detail.fieldData;currency=t.detail.currency.symbol,""==channelName&&(channelName=t.detail.channel.username),settings.stats.refresh_rate=e.stats_refresh_rate,"true"==e.stats_toggle_followers?(state.stats.followers.enabled=!0,state.stats.followers.icon=e.followers_icon,state.stats.followers.count=t.detail.session.data["follower-total"].count):delete state.stats.followers,"true"==e.stats_toggle_subs?(state.stats.subs.enabled=!0,state.stats.subs.icon=e.subs_icon,state.stats.subs.count=t.detail.session.data["subscriber-total"].count):delete state.stats.subs,"true"==e.stats_toggle_viewers?(state.stats.viewers.enabled=!0,state.stats.viewers.icon=e.viewers_icon,getViewerStat()):delete state.stats.viewers,"true"==e.latest_toggle_follower?(state.latest.follower.empty=e.latest_follower_empty,state.latest.follower.enabled=!0,state.latest.follower.icon=e.followers_icon,""!=t.detail.session.data["follower-latest"].name&&(state.latest.follower.name=t.detail.session.data["follower-latest"].name)):delete state.latest.follower,"true"==e.latest_toggle_donation?(state.latest.donation.empty=e.latest_donation_empty,state.latest.donation.enabled=!0,state.latest.donation.icon=e.donation_icon,""!=t.detail.session.data["tip-latest"].name&&(state.latest.donation.name=t.detail.session.data["tip-latest"].name,state.latest.donation.amount=t.detail.session.data["tip-latest"].amount)):delete state.latest.donation,"true"==e.latest_toggle_cheer?(state.latest.cheer.empty=e.latest_cheer_empty,state.latest.cheer.enabled=!0,state.latest.cheer.icon=e.cheer_icon,""!=t.detail.session.data["cheer-latest"].name&&(state.latest.cheer.name=t.detail.session.data["cheer-latest"].name,state.latest.cheer.amount=t.detail.session.data["cheer-latest"].amount)):delete state.latest.cheer,"true"==e.latest_toggle_subscriber?(state.latest.subscriber.empty=e.latest_subscriber_empty,state.latest.subscriber.enabled=!0,state.latest.subscriber.icon=e.subs_icon,""!=t.detail.session.data["subscriber-latest"].name&&(state.latest.subscriber.name=t.detail.session.data["subscriber-latest"].name,state.latest.subscriber.amount=t.detail.session.data["subscriber-latest"].amount)):delete state.latest.subscriber,"true"==e.latest_toggle_raid?(state.latest.raid.empty=e.latest_raid_empty,state.latest.raid.enabled=!0,state.latest.raid.icon=e.raid_icon,""!=t.detail.session.data["raid-latest"].name&&(state.latest.raid.name=t.detail.session.data["raid-latest"].name,state.latest.raid.amount=t.detail.session.data["raid-latest"].amount)):delete state.latest.raid,start()})),window.addEventListener("onSessionUpdate",(function(t){state.stats.subs&&(state.stats.subs.count=t.detail.session["subscriber-total"].count),state.latest.donation&&(state.latest.donation.name=t.detail.session["tip-latest"].name,state.latest.donation.amount=t.detail.session["tip-latest"].amount),state.latest.cheer&&(state.latest.cheer.name=t.detail.session["cheer-latest"].name,state.latest.cheer.amount=t.detail.session["cheer-latest"].amount),state.latest.subscriber&&(state.latest.subscriber.name=t.detail.session["subscriber-latest"].name,state.latest.subscriber.amount=t.detail.session["subscriber-latest"].amount),state.latest.follower&&(state.latest.follower.name=t.detail.session["follower-latest"].name),state.latest.raid&&(state.latest.raid.name=t.detail.session["raid-latest"].name),state.stats.followers&&(state.stats.followers.count=t.detail.session["follower-total"].count)}));